<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PRISM - Rapid Response</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-main: #0a0e14; --text-primary: #ffffff; --text-secondary: #8ba0b6;
            --accent-cyan: #00dddf; --accent-red: #ff3333;
            --glow-cyan: 0 0 25px rgba(0, 221, 223, 0.6); --glow-red: 0 0 30px rgba(255, 51, 51, 0.8);
            --glass-bg: rgba(30, 35, 45, 0.95);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body {
            background: radial-gradient(ellipse at bottom center, #1b2735 0%, #0a0e14 100%);
            color: var(--text-primary); height: 100vh; overflow: hidden;
            display: flex; justify-content: center; align-items: center;
        }

        /* --- 1. INTRO ANIMATION STYLES (RESTORED) --- */
        #intro-sequence { position: absolute; text-align: center; transition: all 1.5s ease-in-out; z-index: 10; }
        .prism-title { font-size: 5rem; font-weight: 800; letter-spacing: 10px; }
        .letter { display: inline-block; opacity: 0; transform: translateY(100px); animation: floatInUp 0.8s forwards; }
        .letter:nth-child(1) { animation-delay: 0.5s; color: var(--accent-cyan); }
        .letter:nth-child(2) { animation-delay: 0.7s; } .letter:nth-child(3) { animation-delay: 0.9s; }
        .letter:nth-child(4) { animation-delay: 1.1s; } .letter:nth-child(5) { animation-delay: 1.3s; }
        .prism-subtitle { margin-top: 20px; color: var(--accent-cyan); letter-spacing: 2px; opacity: 0; animation: fadeIn 1s forwards 2s; }

        @keyframes floatInUp { to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeIn { to { opacity: 1; } }

        /* Transition States */
        body.sequence-finished #intro-sequence { top: 30px; right: 40px; transform: scale(0.4); opacity: 0; pointer-events: none; }
        body.sequence-finished #main-content { opacity: 1; transform: translateY(0); transition-delay: 1s; pointer-events: all;}

        /* --- 2. MAIN CONTENT STYLES --- */
        #main-content { 
            opacity: 0; transform: translateY(30px); transition: all 1s ease-out; 
            text-align: center; z-index: 5; max-width: 900px; padding: 20px;
            pointer-events: none; /* Prevent clicking before animation ends */
        }

        .hero-text h1 { font-size: 2.5rem; margin-bottom: 20px; }
        .hero-text p { font-size: 1.1rem; color: var(--text-secondary); line-height: 1.6; max-width: 800px; margin: 0 auto 40px; }
        .highlight { color: var(--accent-cyan); font-weight: 600; }

        .btn-container { display: flex; gap: 30px; justify-content: center; margin-top: 30px;}
        .futuristic-btn {
            padding: 20px 40px; font-size: 1.2rem; font-weight: 600; border-radius: 12px;
            cursor: pointer; transition: 0.3s; display: flex; align-items: center; gap: 15px;
            text-decoration: none; backdrop-filter: blur(10px); border: 1px solid transparent;
        }
        .btn-register { background: rgba(0, 221, 223, 0.1); color: var(--accent-cyan); border-color: var(--accent-cyan); }
        .btn-register:hover { box-shadow: var(--glow-cyan); transform: translateY(-5px); }
        .btn-emergency { background: rgba(255, 51, 51, 0.2); color: var(--accent-red); border-color: var(--accent-red); animation: pulse-red-btn 2s infinite; }
        .btn-emergency:hover { box-shadow: var(--glow-red); transform: translateY(-5px); }

        @keyframes pulse-red-btn { 0% { box-shadow: 0 0 0 0 rgba(255, 51, 51, 0.4); } 70% { box-shadow: 0 0 0 20px transparent; } }

        /* --- 3. MODAL & TABS STYLES (NEW FEATURE) --- */
        #modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 100; display: none; justify-content: center; align-items: center; backdrop-filter: blur(5px);}
        .modal-box { background: #151a21; border: 2px solid var(--accent-red); padding: 30px; border-radius: 20px; width: 500px; text-align: center; position: relative; box-shadow: 0 0 50px rgba(255,51,51,0.2); }
        
        .tab-container { display: flex; margin-bottom: 20px; border-bottom: 1px solid #333; }
        .tab { flex: 1; padding: 15px; cursor: pointer; color: #666; font-weight: bold; transition: 0.3s; }
        .tab.active { color: var(--accent-red); border-bottom: 3px solid var(--accent-red); background: rgba(255,51,51,0.05); }
        
        .tab-content { display: none; padding: 20px 0; }
        .tab-content.active { display: block; animation: fadeIn 0.5s; }

        .input-box { width: 100%; padding: 15px; font-size: 1.5rem; text-align: center; background: #000; border: 1px solid #444; color: white; border-radius: 8px; margin-bottom: 20px; }
        .action-btn { width: 100%; padding: 15px; font-size: 1.2rem; font-weight: bold; border: none; border-radius: 8px; cursor: pointer; transition: 0.3s; }
        .btn-red { background: var(--accent-red); color: white; }
        .btn-red:hover { box-shadow: 0 0 20px var(--accent-red); }

        .finger-icon { font-size: 5rem; color: var(--accent-red); margin: 20px 0; display: block; }
        .scanning { animation: scanPulse 1s infinite alternate; }
        @keyframes scanPulse { from { opacity: 0.5; text-shadow: 0 0 10px var(--accent-red); } to { opacity: 1; text-shadow: 0 0 30px var(--accent-red); } }
    </style>
</head>
<body>

    <div id="intro-sequence">
        <div class="prism-title"><span class="letter">P</span><span class="letter">R</span><span class="letter">I</span><span class="letter">S</span><span class="letter">M</span></div>
        <div class="prism-subtitle">Patient Rapid Information System for Medicine</div>
    </div>

    <main id="main-content">
        <div class="hero-text">
            <h1>The Future of Critical Care Data.</h1>
            <p>
                PRISM connects emergency responders with instant <span class="highlight">biometric patient identification</span>. 
                Secure, rapid, and life-saving.
            </p>
        </div>
        
        <div class="btn-container">
            <a href="prism-form.html" class="futuristic-btn btn-register">
                <i class="fa-solid fa-user-plus"></i> Register New Patient
            </a>
            <button id="emBtn" class="futuristic-btn btn-emergency">
                <i class="fa-solid fa-truck-medical"></i> EMERGENCY ACCESS
            </button>
        </div>
    </main>

    <div id="modal">
        <div class="modal-box">
            <button onclick="closeModal()" style="position: absolute; right: 15px; top: 15px; background: none; border: none; color: #666; font-size: 1.5rem; cursor: pointer;">&times;</button>
            <h2 style="color: var(--accent-red); margin-bottom: 20px;">AUTHENTICATION REQUIRED</h2>

            <div class="tab-container">
                <div class="tab active" onclick="switchTab('finger')"><i class="fa-solid fa-fingerprint"></i> Biometric</div>
                <div class="tab" onclick="switchTab('passkey')"><i class="fa-solid fa-key"></i> Passkey</div>
            </div>

            <div id="tab-finger" class="tab-content active">
                <i id="fpIcon" class="fa-solid fa-fingerprint finger-icon"></i>
                <p id="fpStatus" style="color: #aaa; margin-bottom: 20px;">Place patient finger on sensor</p>
                <button id="scanBtn" class="action-btn btn-red">START SCAN</button>
            </div>

            <div id="tab-passkey" class="tab-content">
                <input type="text" id="passkeyInput" class="input-box" placeholder="ENTER PASSKEY">
                <button id="passkeyBtn" class="action-btn btn-red">FETCH DATA</button>
                <p id="pkStatus" style="color: var(--accent-red); margin-top: 10px;"></p>
            </div>
        </div>
    </div>

    <script>
        // --- ANIMATION LOGIC (RESTORED) ---
        window.addEventListener('load', () => {
            setTimeout(() => { document.body.classList.add('sequence-finished'); }, 3500);
        });

        // --- MODAL & TABS LOGIC ---
        const modal = document.getElementById('modal');
        document.getElementById('emBtn').onclick = () => modal.style.display = 'flex';
        function closeModal() { modal.style.display = 'none'; }
        
        function switchTab(type) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            if(type === 'finger') {
                document.querySelector('.tab:first-child').classList.add('active');
                document.getElementById('tab-finger').classList.add('active');
            } else {
                document.querySelector('.tab:last-child').classList.add('active');
                document.getElementById('tab-passkey').classList.add('active');
            }
        }

        // --- FINGERPRINT API ---
        const fpBtn = document.getElementById('scanBtn');
        const fpStatus = document.getElementById('fpStatus');
        const fpIcon = document.getElementById('fpIcon');

        fpBtn.onclick = async () => {
            fpBtn.disabled = true;
            fpIcon.classList.add('scanning');
            fpStatus.innerText = "Sensor Active... Waiting for finger...";

            try {
                const res = await fetch('/api/scan-search', { method: 'POST' });
                const data = await res.json();

                if (data.success) {
                    fpStatus.style.color = "#00ff00";
                    fpStatus.innerText = "MATCH FOUND! Redirecting...";
                    sessionStorage.setItem('prismPatientData', JSON.stringify(data.patientData));
                    setTimeout(() => window.location.href = 'prism-dashboard.html', 1000);
                } else {
                    fpIcon.classList.remove('scanning');
                    fpStatus.style.color = "var(--accent-red)";
                    fpStatus.innerText = data.message;
                    fpBtn.disabled = false;
                }
            } catch (e) {
                fpIcon.classList.remove('scanning');
                fpStatus.innerText = "Connection Error";
                fpBtn.disabled = false;
            }
        };

        // --- PASSKEY API ---
        document.getElementById('passkeyBtn').onclick = async () => {
            const pk = document.getElementById('passkeyInput').value;
            if(!pk) return;
            
            try {
                const res = await fetch('/api/emergency-fetch', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ passkey: pk })
                });
                const data = await res.json();
                
                if(data.success) {
                    sessionStorage.setItem('prismPatientData', JSON.stringify(data.patientData));
                    window.location.href = 'prism-dashboard.html';
                } else {
                    document.getElementById('pkStatus').innerText = data.message;
                }
            } catch(e) { console.error(e); }
        };
    </script>
</body>
</html>